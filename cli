#!/bin/bash

setup() {
    poetry install && \
    poetry run pre-commit install
}

lint() {
    poetry run pre-commit run --all-files
}

test() {
    export API_SPEC_PATH="$PWD/api-spec/"
    poetry run pytest
}

autoupdate() {
    poetry update && \
    poetry run pre-commit autoupdate
}

serve() {
    export API_SPEC_PATH="$PWD/api-spec/"
    poetry run uvicorn finn_codesubmit.app:app --reload
}

case "$1" in
    setup)
        setup
        ;;
    lint)
        lint
        ;;
    test)
        test
        ;;
    autoupdate)
        autoupdate
        ;;
    serve)
        serve
        ;;
    *)
        echo "Error: Invalid command. Available commands: setup | lint | test | autoupdate | serve"
        ;;
esac
